---
import ToolLayout from "@/layouts/ToolLayout.astro";
import YamlJsonTool from "@/components/vue/tools/YamlJsonTool.vue";
import FAQAccordion from "@/components/FAQAccordion.astro";
import ToolNewsletterCTA from "@/components/ToolNewsletterCTA.astro";
import {
  getToolBySlugOrThrow,
  generateToolStructuredData,
  generateFAQStructuredData,
} from "@/data/tools";

var tool = getToolBySlugOrThrow("yaml-json");
var structuredData = generateToolStructuredData(tool);
var faqData = generateFAQStructuredData(tool.faqs);

var commonErrors = [
  {
    pattern: "tabs",
    title: "Tab Characters",
    description: "YAML requires spaces for indentation, not tabs",
    suggestion: "Replace all tabs with spaces (typically 2 spaces per level)",
  },
  {
    pattern: "colon",
    title: "Missing Colon",
    description: "Keys must be followed by a colon and space",
    suggestion: "Add a colon after the key name: key: value",
  },
  {
    pattern: "indent",
    title: "Inconsistent Indentation",
    description: "All items at the same level must have identical indentation",
    suggestion: "Use consistent 2-space indentation throughout",
  },
  {
    pattern: "quote",
    title: "Unquoted Special Characters",
    description: "Values with special characters need quotes",
    suggestion: "Wrap values containing : @ # & * in quotes",
  },
  {
    pattern: "duplicate",
    title: "Duplicate Keys",
    description: "Each key must be unique within its mapping",
    suggestion: "Rename or remove the duplicate key",
  },
  {
    pattern: "anchor",
    title: "Invalid Anchor/Alias",
    description: "Anchors (&) and aliases (*) must reference valid nodes",
    suggestion: "Ensure anchor is defined before alias reference",
  },
];

var yamlSyntax = [
  {
    syntax: "key: value",
    description: "Key-value pair (mapping)",
    example: "name: John",
  },
  {
    syntax: "- item",
    description: "List item (sequence)",
    example: "- apple\\n- banana",
  },
  {
    syntax: "|",
    description: "Literal block scalar (preserves newlines)",
    example: "text: |\\n  line1\\n  line2",
  },
  {
    syntax: ">",
    description: "Folded block scalar (joins lines)",
    example: "text: >\\n  long\\n  text",
  },
  {
    syntax: "&anchor",
    description: "Define an anchor",
    example: "defaults: &defaults\\n  timeout: 30",
  },
  {
    syntax: "*alias",
    description: "Reference an anchor",
    example: "production:\\n  <<: *defaults",
  },
  {
    syntax: "# comment",
    description: "Comment (ignored)",
    example: "# This is a comment",
  },
  {
    syntax: "---",
    description: "Document start marker",
    example: "---\\ndoc1\\n---\\ndoc2",
  },
  { syntax: "null / ~", description: "Null value", example: "empty: null" },
  {
    syntax: "true / false",
    description: "Boolean values",
    example: "enabled: true",
  },
  {
    syntax: "'string'",
    description: "Single-quoted string (literal)",
    example: "path: 'C:\\\\path'",
  },
  {
    syntax: '"string"',
    description: "Double-quoted string (escapes)",
    example: 'msg: "Hello\\\\nWorld"',
  },
];
---

<ToolLayout
  title={tool.title}
  description={tool.description}
  ogImage={tool.ogImage}
  canonicalPath={"/tools/" + tool.slug}
  structuredData={structuredData}
  keywords={tool.keywords}
>
  {
    faqData && (
      <Fragment slot="head">
        <script type="application/ld+json" set:html={JSON.stringify(faqData)} />
      </Fragment>
    )
  }

  <!-- Tool Header -->
  <div class="tool-header">
    <h1>{tool.title}</h1>
    <p class="subtitle">
      Validate, format, and convert between YAML and JSON. Client-side
      processing â€” your data never leaves your browser.
    </p>
  </div>

  <div class="tool-content">
    <!-- Main Tool Card with Vue Island -->
    <div class="tool-card">
      <YamlJsonTool client:only="vue" />
    </div>

    <!-- Reference Section: YAML Syntax -->
    <div class="tool-card reference-section">
      <h2>YAML Syntax Reference</h2>
      <p class="section-intro">
        Quick reference for YAML 1.2 syntax. YAML is a superset of JSON, so
        valid JSON is also valid YAML.
      </p>
      <div class="reference-table-wrapper">
        <table class="reference-table">
          <thead>
            <tr>
              <th>Syntax</th>
              <th>Description</th>
              <th>Example</th>
            </tr>
          </thead>
          <tbody>
            {
              yamlSyntax.map(function renderSyntax(item) {
                return (
                  <tr>
                    <td>
                      <code>{item.syntax}</code>
                    </td>
                    <td>{item.description}</td>
                    <td>
                      <code class="example-code">{item.example}</code>
                    </td>
                  </tr>
                );
              })
            }
          </tbody>
        </table>
      </div>
    </div>

    <!-- Reference Section: Common Errors -->
    <div class="tool-card errors-section">
      <h2>Common YAML Errors & How to Fix Them</h2>
      <div class="errors-grid">
        {
          commonErrors.map(function renderError(error) {
            return (
              <div class="error-card">
                <h3>{error.title}</h3>
                <p class="error-description">{error.description}</p>
                <p class="error-fix">
                  <strong>Fix:</strong> {error.suggestion}
                </p>
              </div>
            );
          })
        }
      </div>
    </div>

    <!-- FAQ Section -->
    <div class="tool-card">
      <FAQAccordion faqs={tool.faqs} />
    </div>

    <!-- Newsletter CTA -->
    <div class="tool-card">
      <ToolNewsletterCTA
        pageUrl="/tools/yaml-json"
        variant="yaml-json-tool"
        title="Like This Tool?"
        description="Get weekly DevOps tips and production insights from 8+ years of YAML debugging in the trenches."
      />
    </div>
  </div>
</ToolLayout>

<style>
  @import "@/styles/tools.css";
</style>
